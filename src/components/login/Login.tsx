"use client";
import Image from "next/image";
import React, { useEffect, useState } from "react";
import { z } from "zod";
import { zodResolver } from "@hookform/resolvers/zod";
import { useForm } from "react-hook-form";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useMutation } from "@tanstack/react-query";
import { LOGIN_DATA, sendLoginRequest } from "./actions";
import Cookies from "js-cookie";
import Loading from "@/src/app/loading";
const schema = z.object({
  username: z.string().refine((value) => value != "", {
    message: "این فیلد الزامی است",
  }),
  password: z.string().min(8, "رمز عبور باید بیشتر از 8 حرف باشد"),
});
type FormField = z.infer<typeof schema>;

const Login: React.FC = () => {
  const [userlogin, setUserlogin] = useState<LOGIN_DATA>({
    username: "",
    password: "",
    remember_me: false,
  });
  const router = useRouter();
  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<FormField>({
    resolver: zodResolver(schema),
  });
  const onSubmit = (data: FormField) => {
    setUserlogin({
      ...userlogin,
      username: data.username,
      password: data.password,
    });
    mutation.mutate({
      username: data.username,
      password: data.password,
      remember_me: userlogin.remember_me,
    });
    console.log(userlogin, "userLogin Data");

    reset();
  };
  const mutation = useMutation({
    mutationFn: sendLoginRequest,
    mutationKey: ["login-request"],
    onSuccess: (data) => {
      console.log("successful");

      const token = data.token;
      console.log(token, "token");
      Cookies.set("authToken", token, {
        expires: userlogin.remember_me ? 7 : 1,
        path: "/",
        secure: process.env.NODE_ENV === "production",
        sameSite: "strict",
      });

      router.push("/admin/dashboard");
    },
    onError: (error) => {
      throw new Error("unknown Error:" + error);
    },
  });
  useEffect(() => {
    console.log(userlogin, "this is userLogin");
  }, [userlogin]);
  if (mutation.isPending) {
    return <Loading />;
  }
  if (mutation.isError) {
    <h1>error</h1>;
  }
  return (
    <div className="w-full h-fit flex flex-row items-start justify-between ">
      <div className="w-[62.01388888888889%] h-[100vh]  max-lg:w-[400px] max-[450px]:w-[90%]   max-lg:h-[480px] max-lg:absolute top-[50%] max-lg:left-[50%] max-lg:translate-x-[-50%] max-lg:translate-y-[-50%] lg:pt-8    ">
        <div className="w-[468px] max-lg:w-full flex flex-col items-center justify-normal mx-auto  h-fit ">
          <svg
            className="mb-[55px]"
            width="95"
            height="115"
            viewBox="0 0 95 115"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect x="4.5" width="86" height="86" rx="10" fill="#FF0C0C" />
            <path
              d="M52.3439 57.1494C47.8825 55.4923 43.2935 55.2374 39.087 56.3846C36.1552 57.1494 33.3509 58.679 30.8014 60.5911L29.0168 62.1208C28.7402 62.3974 28.7535 62.8498 29.0459 63.1097L29.3736 63.401C29.5543 63.5616 29.7381 63.7343 29.9091 63.9053C30.1641 64.1603 30.419 64.2877 30.8014 64.5427C31.2551 64.8451 31.8536 64.8131 32.2724 64.4641L32.3311 64.4152C32.7161 64.0301 33.1764 63.7248 33.6085 63.3935C35.7334 61.764 38.0587 60.6599 40.4892 60.0812C43.9309 59.1889 47.6275 59.3164 51.3241 60.7186C54.3834 61.8658 60.6295 63.268 68.1502 60.0812L68.269 60.0218C68.3592 59.9767 68.4416 59.9174 68.5128 59.8461L68.5221 59.8368C68.6921 59.6668 68.8726 59.4864 69.0426 59.3164C69.6799 58.5516 70.3173 57.7868 70.8271 56.8945C71.4827 55.8784 70.3514 54.6445 69.2975 55.2373C63.3064 58.5516 57.8252 59.1889 52.3439 57.1494Z"
              fill="white"
            />
            <path
              d="M49.5747 29.3207C49.342 32.8686 48.0611 36.3385 45.5699 39.4086C42.8376 42.8017 37.5005 52.0465 43.8667 66.5012L45.0822 68.9166L45.1633 69.0776L45.1788 69.1086C45.366 69.4805 45.7569 69.7052 46.1726 69.6796C46.6967 69.7186 47.3819 69.6765 48.067 69.6344L48.3271 69.6282C49.0864 69.6101 49.568 68.8073 49.2266 68.1289C49.1766 68.0295 49.1064 67.9417 49.0464 67.8481C48.9276 67.6628 48.8754 67.431 48.7459 67.1738C45.0592 60.0485 42.2113 49.9784 48.7199 41.6577C51.6932 37.9415 53.3751 33.6643 53.6056 29.3102C53.7953 25.0962 52.8669 21.0448 51.0186 16.9568C51.0091 16.9358 51.0291 16.9133 51.051 16.9206C51.0738 16.9281 51.0941 16.9038 51.0826 16.8828L49.9575 14.8159C49.8422 14.604 49.7243 14.3795 49.6159 14.1641L49.609 14.1505C49.4625 13.8592 49.1738 13.6662 48.8487 13.6421C48.2344 13.5669 47.584 13.6015 46.9663 13.5368C46.9042 13.5303 46.8419 13.5275 46.7796 13.53L46.6796 13.5339C45.8152 13.5682 45.325 14.539 45.8105 15.2549C45.8502 15.3134 45.8971 15.3666 45.9399 15.4228C45.9749 15.4689 46.0045 15.5176 46.0319 15.5675C46.2042 15.8817 46.3894 16.1942 46.5344 16.5219C47.976 19.7807 49.868 24.1833 49.5747 29.3207Z"
              fill="white"
            />
            <path
              d="M21.7385 41.8579C22.2257 41.3148 22.765 40.816 23.2928 40.3122C26.0286 37.7014 29.0736 36.0275 32.331 35.0968C35.7727 34.2045 39.4694 34.332 43.166 35.7341C54.6383 39.9406 64.581 33.0572 68.915 29.3606L70.5721 27.7035C70.9327 27.415 71.0129 26.8987 70.7567 26.5145L70.7493 26.5033C70.7163 26.4538 70.678 26.4079 70.6374 26.3643C70.2887 25.9901 70.0412 25.5084 69.6799 25.0266L69.6722 25.0164C69.2726 24.4835 68.4937 24.4282 68.0227 24.8991C67.8953 25.0266 67.6403 25.2815 67.5129 25.409C62.1591 30.5078 53.8735 35.7341 44.4407 32.165C39.9792 30.5079 35.3903 30.2529 31.1838 31.4001C28.5069 32.165 25.9575 33.4397 23.4081 35.0968L20.7312 37.2638C20.4763 37.5187 20.3488 37.6462 20.0939 37.9011L20.0698 37.9252C19.922 38.073 19.8389 38.2735 19.8389 38.4825C19.8389 38.5198 19.8362 38.557 19.8312 38.594C19.7114 39.4677 19.7088 40.3389 19.584 41.0879L19.5827 41.1211C19.539 42.2131 20.8732 42.7747 21.6235 41.9802C21.6617 41.942 21.6999 41.901 21.7385 41.8579Z"
              fill="white"
            />
            <path
              d="M56.0403 65.817L55.7854 66.5819L56.0403 65.817C55.6579 65.6896 55.403 65.5621 55.0206 65.4346C50.5591 63.7775 45.9702 63.5226 41.7637 64.6698C40.8714 64.9248 39.9791 65.1797 39.0868 65.5621L36.0275 66.9643C35.7416 67.1072 35.7681 67.5235 36.0698 67.6291L37.8121 68.239C38.5769 68.4939 39.3417 68.7489 40.1066 69.0038C40.3548 69.0865 40.6232 69.0865 40.8714 69.0038C41.2538 68.8763 41.6362 68.6214 42.0186 68.6214C42.5594 68.6214 43.0469 68.2944 43.5768 68.1867C46.4135 67.6101 49.4633 67.7001 52.7261 68.7488C53.1085 68.8763 53.3635 69.0038 53.7459 69.1313L54.009 69.2365C54.2506 69.3332 54.5187 69.341 54.7656 69.2587C55.6579 69.0038 56.6777 68.7489 57.4425 68.3664C58.5006 67.9886 58.4072 66.4631 57.3151 66.1994C56.9326 66.072 56.4228 65.9445 56.0403 65.817Z"
              fill="white"
            />
            <path
              d="M27.1048 27.7032L26.7224 26.9384L27.1048 27.7032C27.8696 27.3208 28.762 27.0659 29.5268 26.8109C32.9685 25.9186 36.6651 26.0461 40.3618 27.4483C42.7837 28.3406 45.2056 28.723 47.8825 28.723C53.2362 28.723 58.59 26.8109 63.5613 23.1143L65.4734 21.5846C65.7984 21.3246 65.795 20.8292 65.4665 20.5737L64.9635 20.1825C64.5811 19.8 64.0712 19.4176 63.5613 19.1627L63.3897 19.0483C63.0364 18.8128 62.5714 18.833 62.2398 19.0982C62.1862 19.1411 62.127 19.1765 62.0702 19.2151C61.9763 19.2792 61.8987 19.3597 61.8196 19.4385C61.6403 19.6172 61.4193 19.7508 61.2156 19.9011C54.5618 24.8129 47.9137 26.137 41.6365 23.7516C37.0475 22.0945 32.4586 21.7121 27.8696 23.1143C27.5156 23.2323 27.1616 23.3503 26.7065 23.4683C26.6325 23.4875 26.5604 23.5139 26.492 23.5481L26.4761 23.5561C26.386 23.6012 26.3037 23.6605 26.2324 23.7318L26.1718 23.7923C26.0346 23.9295 25.9333 24.0873 25.7755 24.2001C25.7363 24.2282 25.6893 24.2818 25.6622 24.3216C25.1594 25.0599 24.542 25.6838 24.0455 26.4285L23.9143 26.6288C23.295 27.5741 24.3338 28.7264 25.338 28.2081C25.4938 28.1276 25.6673 28.09 25.8417 28.071C26.3562 28.0151 26.7773 27.8124 27.1048 27.7032Z"
              fill="white"
            />
            <path
              d="M37.5573 19.0353L37.9397 19.1628C39.5968 19.8002 42.1462 20.4375 45.333 20.4375C48.6472 20.4375 51.834 19.6727 55.0208 18.398L56.4324 17.7149C57.359 17.2666 57.272 15.9192 56.2955 15.5937C55.5638 15.3498 54.8321 15.1059 53.9888 14.9736C53.9121 14.9616 53.8346 14.9563 53.757 14.9563C53.5809 14.9563 53.4059 14.9847 53.2388 15.0404L53.1087 15.0837C52.7263 15.2112 52.3439 15.4662 51.9614 15.5937C48.1373 16.9958 44.3132 17.2508 40.6166 16.231C40.2342 16.1035 39.8518 15.976 39.4694 15.8486C39.2211 15.7658 38.9528 15.7658 38.7045 15.8486C37.9397 16.1035 37.1749 16.3585 36.4101 16.7409L36.0378 16.9027C35.1718 17.2792 35.2511 18.5326 36.1576 18.797C36.4019 18.8683 36.6728 18.8317 36.9251 18.8643C37.1199 18.8895 37.3386 18.9624 37.5573 19.0353Z"
              fill="white"
            />
            <path
              d="M12.6947 97.7727H8.25838V110H5.81293V97.7727H1.41293V95.7818H12.6947V97.7727ZM19.8509 101.6C19.5418 101.552 19.2206 101.527 18.8873 101.527C17.8024 101.527 17.0691 101.942 16.6873 102.773V110H14.3146V99.4364H16.5782L16.6418 100.618C17.2115 99.697 18.0055 99.2364 19.0237 99.2364C19.363 99.2364 19.6418 99.2818 19.86 99.3727L19.8509 101.6ZM26.0094 110.191C24.5004 110.191 23.2791 109.718 22.3458 108.773C21.4125 107.827 20.9458 106.567 20.9458 104.991V104.7C20.9458 103.645 21.1488 102.703 21.5549 101.873C21.961 101.042 22.5307 100.397 23.264 99.9364C24.0034 99.4697 24.8276 99.2364 25.7367 99.2364C27.1731 99.2364 28.2822 99.697 29.064 100.618C29.8519 101.533 30.2458 102.83 30.2458 104.509V105.473H23.3367C23.4094 106.345 23.7004 107.036 24.2094 107.545C24.7246 108.048 25.3701 108.3 26.1458 108.3C27.2307 108.3 28.1155 107.861 28.8004 106.982L30.0822 108.2C29.6579 108.836 29.0913 109.327 28.3822 109.673C27.6791 110.018 26.8882 110.191 26.0094 110.191ZM25.7185 101.145C25.0701 101.145 24.5458 101.373 24.1458 101.827C23.7458 102.282 23.4913 102.915 23.3822 103.727H27.9004V103.555C27.8458 102.761 27.6337 102.161 27.264 101.755C26.8943 101.348 26.3791 101.145 25.7185 101.145ZM36.7516 110.191C35.2425 110.191 34.0213 109.718 33.088 108.773C32.1547 107.827 31.688 106.567 31.688 104.991V104.7C31.688 103.645 31.891 102.703 32.2971 101.873C32.7031 101.042 33.2728 100.397 34.0062 99.9364C34.7456 99.4697 35.5698 99.2364 36.4789 99.2364C37.9153 99.2364 39.0244 99.697 39.8062 100.618C40.5941 101.533 40.988 102.83 40.988 104.509V105.473H34.0789C34.1516 106.345 34.4425 107.036 34.9516 107.545C35.4668 108.048 36.1122 108.3 36.888 108.3C37.9728 108.3 38.8577 107.861 39.5425 106.982L40.8244 108.2C40.4001 108.836 39.8335 109.327 39.1244 109.673C38.4213 110.018 37.6304 110.191 36.7516 110.191ZM36.4607 101.145C35.8122 101.145 35.288 101.373 34.888 101.827C34.488 102.282 34.2335 102.915 34.1244 103.727H38.6425V103.555C38.588 102.761 38.3759 102.161 38.0062 101.755C37.6365 101.348 37.1213 101.145 36.4607 101.145ZM51.3674 99.4364L51.431 100.655C52.2129 99.7091 53.2401 99.2364 54.5129 99.2364C56.7129 99.2364 57.831 100.497 57.8674 103.018V110H55.4947V103.155C55.4947 102.482 55.3492 101.985 55.0583 101.664C54.7735 101.342 54.3007 101.182 53.6401 101.182C52.6826 101.182 51.9704 101.615 51.5038 102.482V110H49.131V99.4364H51.3674ZM64.9548 110.191C63.4457 110.191 62.2245 109.718 61.2911 108.773C60.3578 107.827 59.8911 106.567 59.8911 104.991V104.7C59.8911 103.645 60.0942 102.703 60.5002 101.873C60.9063 101.042 61.476 100.397 62.2093 99.9364C62.9487 99.4697 63.7729 99.2364 64.682 99.2364C66.1184 99.2364 67.2275 99.697 68.0093 100.618C68.7972 101.533 69.1911 102.83 69.1911 104.509V105.473H62.282C62.3548 106.345 62.6457 107.036 63.1548 107.545C63.6699 108.048 64.3154 108.3 65.0911 108.3C66.176 108.3 67.0608 107.861 67.7457 106.982L69.0275 108.2C68.6032 108.836 68.0366 109.327 67.3275 109.673C66.6245 110.018 65.8335 110.191 64.9548 110.191ZM64.6638 101.145C64.0154 101.145 63.4911 101.373 63.0911 101.827C62.6911 102.282 62.4366 102.915 62.3275 103.727H66.8457V103.555C66.7911 102.761 66.579 102.161 66.2093 101.755C65.8396 101.348 65.3245 101.145 64.6638 101.145ZM80.3242 106.727L82.006 99.4364H84.3151L81.4333 110H79.4788L77.2151 102.745L74.9879 110H73.0333L70.1424 99.4364H72.4606L74.1697 106.655L76.3424 99.4364H78.1242L80.3242 106.727ZM91.8239 107.127C91.8239 106.703 91.6481 106.382 91.2966 106.164C90.9511 105.939 90.3754 105.742 89.5693 105.573C88.7633 105.403 88.0905 105.188 87.5511 104.927C86.3633 104.358 85.7693 103.53 85.7693 102.445C85.7693 101.53 86.1542 100.767 86.9239 100.155C87.6936 99.5424 88.6693 99.2364 89.8511 99.2364C91.1178 99.2364 92.139 99.5485 92.9148 100.173C93.6905 100.797 94.0784 101.609 94.0784 102.609H91.7057C91.7057 102.155 91.536 101.776 91.1966 101.473C90.8633 101.17 90.4148 101.018 89.8511 101.018C89.3299 101.018 88.9057 101.139 88.5784 101.382C88.2511 101.618 88.0875 101.939 88.0875 102.345C88.0875 102.709 88.239 102.994 88.542 103.2C88.8511 103.4 89.4693 103.603 90.3966 103.809C91.3299 104.009 92.0602 104.252 92.5875 104.536C93.1208 104.821 93.5148 105.164 93.7693 105.564C94.0299 105.958 94.1602 106.436 94.1602 107C94.1602 107.952 93.7663 108.721 92.9784 109.309C92.1905 109.897 91.1572 110.191 89.8784 110.191C89.0178 110.191 88.2481 110.036 87.5693 109.727C86.8905 109.412 86.3633 108.982 85.9875 108.436C85.6117 107.891 85.4239 107.303 85.4239 106.673H87.7239C87.7542 107.23 87.9633 107.661 88.3511 107.964C88.7451 108.267 89.2663 108.418 89.9148 108.418C90.539 108.418 91.0117 108.3 91.333 108.064C91.6602 107.827 91.8239 107.515 91.8239 107.127Z"
              fill="#282828"
            />
          </svg>
          <div className="w-full h-full flex flex-row justify-between items-center  mb-[31px]">
            <hr className="bg-black h-[1px] w-[35%]" />{" "}
            <span className=" text-center text-[12px] text-[#4F4F4F] ">
              ورود به حساب کاربری
            </span>{" "}
            <hr className="bg-black h-[1px] w-[35%]" />{" "}
          </div>
          <form onSubmit={handleSubmit(onSubmit)} className="w-full">
            <label
              className=" text-[16px] mb-[8px] block max-sm:text-[15px]"
              htmlFor="username"
            >
              نام کاربری
            </label>
            <input
              {...register("username")}
              className="w-full max-sm:h-[48px]   h-[56px] rounded-[15px] border-[1px] border-solid outline-none px-4 border-[#BDBDBD] mb-[20px] "
              type="text"
              id="username"
            />
            {errors.username && (
              <h3 className="mb-[10px] text-[14px] text-red-600">
                {errors.username.message}
              </h3>
            )}
            <label
              className="text-[16px] mb-[8px] block max-sm:text-[15px]"
              htmlFor="username"
            >
              رمز عبور
            </label>
            <input
              {...register("password")}
              className="w-full  max-sm:h-[48px] h-[56px] rounded-[15px] border-[1px] border-solid outline-none px-4 border-[#BDBDBD] mb-[20px] "
              type="password"
              id="username"
            />
            {errors.password && (
              <h3 className="mb-[10px] text-[14px] text-red-600">
                {errors.password.message}
              </h3>
            )}
            <button className="w-full h-[56px] bg-[#AC2043] rounded-[20px] text-[20px] text-white mb-[14px] max-sm:text-[18px]">
              ورود به حساب
            </button>
            <div className="w-full flex flex-row justify-between items-center">
              <div className="flex w-fit flex-row justify-start items-center gap-x-2">
                <input
                  onChange={(e) => {
                    setUserlogin({
                      ...userlogin,
                      remember_me: e.target.checked,
                    });
                  }}
                  className=" w-[17px] h-[17px] block"
                  type="checkbox"
                  name=""
                  id="rememberMe"
                />

                <label
                  className="text-[#282828] text-[14px]"
                  htmlFor="rememberMe"
                >
                  مرا به خاطر بسپار
                </label>
              </div>
              <Link
                className="text-[#282828] text-[14px]"
                href={"/login/forgetPassword"}
              >
                فراموشی رمز عبور
              </Link>
            </div>
          </form>
        </div>
      </div>
      <div className="w-[37.98611111111111%] h-[100vh] max-lg:hidden relative">
        <Image
          src={"/images/login.png"}
          width={547.6}
          height={1024}
          className="h-full absolute left-0 top-0"
          alt="bg"
        />
        <div className="w-full h-full bg-[#5c0e0ddf] relative">
          <div className="flex justify-center items-center h-screen ">
            <p className="text-7xl text-[#ff0e0e]   font-bold transform  font-sans rotate-[-90deg] pointer-events-none ">
              TREE NEWS
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Login;
